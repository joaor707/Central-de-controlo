<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="utf-8">
    <title>Painel Interativo Portugal e Sismos Mundiais</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <style>
        body { background:#f0f4ff; font-family:sans-serif; }
        #map { height: 550px; width: 100%; border-radius:12px; }
        .painel-legenda { margin-top:20px; background:#fff; padding:16px; border-radius:8px; box-shadow:0 2px 12px rgba(0,24,64,0.06);}
        .painel-legenda h3 {margin-top:0;}
        .painel-legenda .item {margin-bottom:10px;}
        .atualizacao {margin-top:12px; font-size:0.95em; color:#333;}
    </style>
</head>
<body>
    <div class="container">
        <h2>Painel Interativo - Portugal & Sismos Mundiais</h2>
        <div id="map"></div>
        <div class="painel-legenda">
            <h3>Legenda</h3>
            <div class="item"><span style="color:#c0392b;">●</span> Incêndio ativo</div>
            <div class="item"><span style="color:#2980b9;">●</span> Tempestade</div>
            <div class="item"><span style="color:#8e44ad;">●</span> Sismo</div>
        </div>
        <div class="atualizacao" id="ultimaAtualizacao"></div>
    </div>
    <!-- Leaflet JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
    // Check if Leaflet is available
    if (typeof L !== 'undefined') {
        var map = L.map('map').setView([39.5, -8], 2.5);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '© OpenStreetMap'
        }).addTo(map);

        function setAtualizacao() {
            document.getElementById("ultimaAtualizacao").textContent = "Última atualização: " + new Date().toLocaleString("pt-PT");
        }

        // Eventos locais - carrega todos os eventos do arquivo eventos.json
        async function carregarEventosLocais() {
            try {
                const res = await fetch('./eventos.json');
                const eventos = await res.json();
                
                eventos.forEach(evento => {
                    let icon, popupContent;
                    
                    switch (evento.tipo) {
                        case 'incendio':
                            icon = L.divIcon({className: '', html:'<span style="color:#c0392b;font-size:2em;">●</span>'});
                            popupContent = `<b>Incêndio</b><br>Local: ${evento.local}<br>Data: ${new Date(evento.data).toLocaleString("pt-PT")}<br>${evento.descricao}`;
                            break;
                        case 'tempestade':
                            icon = L.divIcon({className: '', html:'<span style="color:#2980b9;font-size:2em;">●</span>'});
                            popupContent = `<b>Tempestade</b><br>Local: ${evento.local}<br>Data: ${new Date(evento.data).toLocaleString("pt-PT")}<br>${evento.descricao}`;
                            break;
                        case 'sismo':
                            icon = L.divIcon({className:'', html:'<span style="color:#8e44ad;font-size:2em;">●</span>'});
                            popupContent = `<b>Sismo</b><br>Local: ${evento.local}<br>Data: ${new Date(evento.data).toLocaleString("pt-PT")}<br>Magnitude: ${evento.magnitude || 'N/A'}<br>${evento.descricao}`;
                            break;
                        default:
                            return; // Skip unknown event types
                    }
                    
                    L.marker([evento.latitude, evento.longitude], {icon: icon}).addTo(map)
                        .bindPopup(popupContent);
                });
            } catch (e) {
                console.log("Erro ao carregar eventos locais:", e);
            }
        }
        carregarEventosLocais();
        setAtualizacao();
    } else {
        // Fallback when Leaflet is not available
        document.getElementById("map").innerHTML = `
            <div style="height:100%;display:flex;align-items:center;justify-content:center;background:#e8f4fd;border:2px dashed #2980b9;border-radius:8px;">
                <div style="text-align:center;padding:20px;">
                    <h3>Mapa Indisponível</h3>
                    <p>Biblioteca Leaflet não pôde ser carregada</p>
                    <p style="font-size:0.9em;color:#666;">Os dados dos eventos estão disponíveis no painel abaixo</p>
                </div>
            </div>
        `;
        
        // Still show the last update time
        function setAtualizacao() {
            document.getElementById("ultimaAtualizacao").textContent = "Última atualização: " + new Date().toLocaleString("pt-PT");
        }
        setAtualizacao();
    }
    </script>
    <script src="painel.js"></script>
</body>
</html>
